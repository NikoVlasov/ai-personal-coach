<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Mentor â€“ Your Personal AI Coach</title>

<!-- === Meta & SEO === -->
<meta name="description" content="AI Mentor is your personal AI coach to help you grow, stay motivated, and improve your daily routines.">
<meta name="keywords" content="AI Mentor, personal coach, AI assistant, productivity, motivation">
<meta name="author" content="AI Mentor Team">

<!-- === Favicon === -->
<link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">

<!-- === OpenGraph === -->
<meta property="og:title" content="AI Mentor â€“ Your Personal AI Coach">
<meta property="og:description" content="Boost your productivity and motivation with AI Mentor.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://ai-personal-coach-rogv.onrender.com">
<meta property="og:image" content="https://ai-personal-coach-rogv.onrender.com/static/og-preview.png">

<!-- === Tailwind === -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">

<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f4f8;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

/* App */
#app-container {
    width: 420px;
    min-height: 700px;
    background: #fff;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

header {
    background-color: #4f8ef7;
    color: white;
    text-align: center;
    font-size: 1.5em;
    font-weight: bold;
    padding: 15px;
}

.hidden { display: none; }

/* Top buttons */
#top-buttons {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    padding: 10px;
}

.top-btn {
    padding: 6px 12px;
    border: none;
    border-radius: 8px;
    background: #4f8ef7;
    color: white;
    cursor: pointer;
}

/* Auth */
#auth-container {
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.auth-tabs {
    display: flex;
    width: 100%;
    margin-bottom: 15px;
}

.auth-tabs button {
    flex: 1;
    padding: 12px;
    border: none;
    cursor: pointer;
    background: #e6edf7;
    font-weight: bold;
}

.auth-tabs button.active {
    background: #4f8ef7;
    color: white;
}

.auth-form {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
}

.auth-form input {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
}

.auth-form button {
    padding: 12px;
    border-radius: 8px;
    border: none;
    background: #4f8ef7;
    color: white;
    font-weight: bold;
    cursor: pointer;
}

/* Chat */
#chat-container {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    background: #e6edf7;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.message {
    max-width: 75%;
    padding: 10px 15px;
    border-radius: 15px;
    white-space: pre-wrap;
}

.user {
    background: #4f8ef7;
    color: white;
    align-self: flex-end;
}

.ai {
    background: white;
    border: 1px solid #ccc;
    align-self: flex-start;
}

/* Memory suggestion (NEW) */
.memory-suggest {
    margin-top: 6px;
    padding: 8px 10px;
    background: #f0f8ff;
    border: 1px dashed #4f8ef7;
    border-radius: 10px;
    font-size: 0.85em;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
}

.memory-suggest button {
    background: #4f8ef7;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 4px 8px;
    cursor: pointer;
}

/* Input */
#input-container {
    display: flex;
    gap: 5px;
    padding: 10px;
}

#input-container input {
    flex: 1;
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
}

#input-container button {
    padding: 8px 12px;
    border-radius: 8px;
    border: none;
    background: #4f8ef7;
    color: white;
    cursor: pointer;
}

/* Mobile */
@media (max-width: 480px) {
    html, body {
        height: 100%;
        margin: 0;
        overflow: hidden;
    }

    #app-container {
        width: 100%;
        height: 100dvh;
        border-radius: 0;
    }
}
</style>
</head>

<body>
<div id="app-container">
<header>AI Mentor</header>

<div id="top-buttons">
    <button class="top-btn" onclick="mainModule.logout()">Logout</button>
</div>

<div id="auth-container">
    <div class="auth-tabs">
        <button id="login-tab" class="active" onclick="authModule.showForm('login')">Login</button>
        <button id="register-tab" onclick="authModule.showForm('register')">Sign Up</button>
    </div>

    <form id="login-form" class="auth-form">
        <input type="email" id="login-email" placeholder="Email">
        <input type="password" id="login-password" placeholder="Password">
        <button type="button" onclick="authModule.login()">Login</button>
    </form>

    <form id="register-form" class="auth-form hidden">
        <input type="email" id="register-email" placeholder="Email">
        <input type="password" id="register-password" placeholder="Password">
        <button type="button" onclick="authModule.register()">Create Account</button>
    </form>
</div>

<div id="chat-ui" class="hidden">
    <div id="chat-container"></div>

    <div id="input-container">
        <input id="message-input" placeholder="Type your message...">
        <button onclick="chatModule.sendMessage()">Send</button>
    </div>
</div>
</div>

<script>
// ===== MAIN =====
const mainModule = (() => {
    let token = null;

    function setToken(t) {
        token = t;
        localStorage.setItem("token", t);
    }

    function getToken() {
        return token;
    }

    function logout() {
        token = null;
        localStorage.removeItem("token");
        document.getElementById("chat-ui").classList.add("hidden");
        document.getElementById("auth-container").style.display = "block";
    }

    return { setToken, getToken, logout };
})();

// ===== CHAT =====
const chatModule = (() => {

    async function saveMemoryFromText(text) {
        await fetch("/memory", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                Authorization: "Bearer " + mainModule.getToken()
            },
            body: JSON.stringify({ key: "note", value: text })
        });
    }

    async function sendMessage() {
        const input = document.getElementById("message-input");
        const text = input.value.trim();
        if (!text) return;

        const userDiv = document.createElement("div");
        userDiv.className = "message user";
        userDiv.textContent = text;

        const chat = document.getElementById("chat-container");
        chat.appendChild(userDiv);
        input.value = "";

        const aiDiv = document.createElement("div");
        aiDiv.className = "message ai";
        aiDiv.textContent = "AI is typing...";
        chat.appendChild(aiDiv);

        const res = await fetch("/coach", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                Authorization: "Bearer " + mainModule.getToken()
            },
            body: JSON.stringify({ text })
        });

        const data = await res.json();
        aiDiv.textContent = data.reply;

        if (data.suggest_memory) {
            const mem = document.createElement("div");
            mem.className = "memory-suggest";
            mem.innerHTML = `
                <span>ðŸ’¾ Remember this?</span>
                <div>
                    <button class="save">Save</button>
                    <button class="dismiss">Dismiss</button>
                </div>
            `;

            aiDiv.appendChild(mem);

            mem.querySelector(".save").onclick = async () => {
                await saveMemoryFromText(text);
                mem.innerHTML = "âœ… Saved";
                setTimeout(() => mem.remove(), 1200);
            };

            mem.querySelector(".dismiss").onclick = () => mem.remove();
        }
    }

    return { sendMessage };
})();

// ===== AUTH =====
const authModule = (() => {

    function showForm(type) {
        document.getElementById("login-form").classList.toggle("hidden", type !== "login");
        document.getElementById("register-form").classList.toggle("hidden", type !== "register");
        document.getElementById("login-tab").classList.toggle("active", type === "login");
        document.getElementById("register-tab").classList.toggle("active", type === "register");
    }

    async function login() {
        const email = document.getElementById("login-email").value;
        const password = document.getElementById("login-password").value;

        const res = await fetch("/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
        });

        const data = await res.json();
        mainModule.setToken(data.access_token);

        document.getElementById("auth-container").style.display = "none";
        document.getElementById("chat-ui").classList.remove("hidden");
    }

    async function register() {
        alert("Register stub");
    }

    return { showForm, login, register };
})();
</script>
</body>
</html>
